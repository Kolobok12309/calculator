var app=function(){"use strict";function t(){}function e(t){return t()}function r(){return Object.create(null)}function n(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e){t.appendChild(e)}function c(t){t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function l(t,e,r){null==r?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}let p;function h(t){p=t}const f=[],g=[],m=[],d=[],$=Promise.resolve();let w=!1;function y(t){m.push(t)}let v=!1;const b=new Set;function k(){if(!v){v=!0;do{for(let t=0;t<f.length;t+=1){const e=f[t];h(e),x(e.$$)}for(h(null),f.length=0;g.length;)g.pop()();for(let t=0;t<m.length;t+=1){const e=m[t];b.has(e)||(b.add(e),e())}m.length=0}while(f.length);for(;d.length;)d.pop()();w=!1,v=!1,b.clear()}}function x(t){if(null!==t.fragment){t.update(),n(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(y)}}const _=new Set;function E(t,e){-1===t.$$.dirty[0]&&(f.push(t),w||(w=!0,$.then(k)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function A(i,s,a,u,l,f,g,m=[-1]){const d=p;h(i);const $=i.$$={fragment:null,ctx:null,props:f,update:t,not_equal:l,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(s.context||(d?d.$$.context:[])),callbacks:r(),dirty:m,skip_bound:!1,root:s.target||d.$$.root};g&&g($.root);let w=!1;if($.ctx=a?a(i,s.props||{},((t,e,...r)=>{const n=r.length?r[0]:e;return $.ctx&&l($.ctx[t],$.ctx[t]=n)&&(!$.skip_bound&&$.bound[t]&&$.bound[t](n),w&&E(i,t)),e})):[],$.update(),w=!0,n($.before_update),$.fragment=!!u&&u($.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);$.fragment&&$.fragment.l(t),t.forEach(c)}else $.fragment&&$.fragment.c();s.intro&&((v=i.$$.fragment)&&v.i&&(_.delete(v),v.i(b))),function(t,r,i,s){const{fragment:c,on_mount:a,on_destroy:u,after_update:l}=t.$$;c&&c.m(r,i),s||y((()=>{const r=a.map(e).filter(o);u?u.push(...r):n(r),t.$$.on_mount=[]})),l.forEach(y)}(i,s.target,s.anchor,s.customElement),k()}var v,b;h(d)}function S(e){let r,n,o,i,p,h,f;return{c(){r=a("main"),n=a("h1"),o=u("Hello "),i=u(e[0]),p=u("!"),h=u(" "),f=a("p"),f.innerHTML='Visit the <a href="https://svelte.dev/tutorial">Svelte tutorial</a> to learn\n    how to build Svelte apps.',l(n,"class","svelte-1hoym3u"),l(r,"class","svelte-1hoym3u")},m(t,e){!function(t,e,r){t.insertBefore(e,r||null)}(t,r,e),s(r,n),s(n,o),s(n,i),s(n,p),s(r,h),s(r,f)},p(t,[e]){1&e&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(i,t[0])},i:t,o:t,d(t){t&&c(r)}}}function V(t,e,r){let{name:n}=e;return t.$$set=t=>{"name"in t&&r(0,n=t.name)},[n]}class R{constructor({token:t,priority:e=0,oneArgument:r=!1,view:n,calc:o}={}){if(this.token=t,this.priority=e,this.oneArgument=r,this.calc=o,n)this.view=n;else{const e=Array.isArray(t);if(e&&!t.length)throw new Error("View is required for twoArgument operators without token");const n=e?t[0]:t;this.view=r?t=>`${t}${n}`:(t,e)=>`${t} ${n} ${e}`}}}var O=new R({token:"empty",view:t=>t,calc:t=>t}),j=new R({token:"+",calc:(t,e)=>t+e}),B=new R({token:"-",calc:(t,e)=>t-e}),N=new R({token:"*",priority:5,calc:(t,e)=>t*e}),T=new R({token:"/",priority:5,calc:(t,e)=>t/e}),M=new R({token:"^",priority:5,calc:(t,e)=>t**e,view:(t,e)=>`${t}^${e}`}),q=new R({token:"sqr",priority:5,oneArgument:!0,calc:t=>t*t});const C=t=>{if(t<0)throw new Error("Negative value hasn't factorial");if(t%1)throw new Error("Fraction value hasn't factorial");return t>=0&&t<=2?t:t*C(t-1)};var F=new R({token:"!",priority:10,oneArgument:!0,calc:C,view:t=>`${t}!`});const H=[j,B,N,T,M,q,F];class L{constructor(t,e,r,n){this.operator=t,this.priority=e,this.v1=r,this.v2=n}get bracketLevel(){return(this.priority-this.operator.priority)/100}getV1View(t=1){if(0===t)return`${this.exec()}`;if(this.v1 instanceof L){const e=this.v1.operator.priority<this.operator.priority,r=this.v1.view(t-1);return e&&t>1?`(${r})`:r}return`${this.v1}`}getV2View(t=1){if(0===t)return`${this.exec()}`;if(this.v2 instanceof L){const e=this.v2.operator.priority<this.operator.priority,r=this.v2.view(t-1);return e&&t>1?`(${r})`:r}return`${this.v2}`}view(t=1){if(0===t)return`${this.exec()}`;const e=this.getV1View(t);if(this.operator.oneArgument)return this.operator.view(e);const r=this.getV2View(t);return this.operator.view(e,r)}exec(){if(this.result)return this.result;const t=this.v1 instanceof L?this.v1.exec():this.v1;if(this.operator.oneArgument)return this.result=this.operator.calc(t),this.result;const e=this.v2 instanceof L?this.v2.exec():this.v2;return this.result=this.operator.calc(t,e),this.result}}const I=(t="")=>t.replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&");class P{constructor({operators:t=H}={}){this.operators=t}static getMatchRegex(t=[]){const e=t.reduce(((t,{token:e})=>t.concat(e)),[]).map(I).join("|"),r=[{matcher:P.numberRegexpString,name:"number"},{matcher:P.bracketsRegexpString,name:"bracket"},{matcher:e,name:"operator"}].map((({name:t,matcher:e})=>`(?<${t}>${e})`)).join("|");return new RegExp(r,"g")}static validateBrackets(t){const e=t.match(new RegExp(P.bracketsRegexpString,"g"));if(!e)return!0;let r=0;return e.forEach((t=>{")"===t?r--:r++})),0===r}getOperatorByToken(t){return this.operators.find((e=>"string"==typeof e.token?e.token===t:e.token.includes(t)))}parseString(t){const e=P.getMatchRegex(this.operators),r=[];let n=null,o=null,i=0;for(;n=e.exec(t);){const{number:t,bracket:e,operator:s}=n.groups;if(e)")"===e?i-=100:"("===e&&(o&&o.groups.number&&r.push({operator:N,priority:i+N.priority}),i+=100);else if(s){const t=this.getOperatorByToken(s);r.push({operator:t,priority:i+t.priority})}else if(t){const{groups:{bracket:e=null}={}}=o||{};")"===e&&r.push({operator:N,priority:i+N.priority}),r.push(parseFloat(t.replace(",",".")))}o=n}return r}compile(t=""){if(!P.validateBrackets(t))throw new Error("Invalid brackets");const e=this.parseString(t),r=e.filter((t=>"number"!=typeof t)),n=e.slice();if(r.sort(((t,e)=>e.priority-t.priority)).forEach((t=>{const{operator:e,priority:r}=t,o=n.indexOf(t);console.log(r,e,o);const i=n[o-1];if(e.oneArgument)n.splice(o-1,2,new L(e,r,i));else{const t=n[o+1];n.splice(o-1,3,new L(e,r,i,t))}})),n.length>1)throw new Error('Wrong arguments location with "oneArgument" operators');if(!n.length)throw new Error("No operators");const o=n[0];return"number"==typeof o?new L(O,0,o):o}calc(t=""){return this.compile(t).exec()}}P.numberRegexpString="(?:[-+])?\\d+(?:[,.]\\d+)?",P.bracketsRegexpString="[()]",window.Calculator=P,window.calc=new P;return new class extends class{$destroy(){!function(t,e){const r=t.$$;null!==r.fragment&&(n(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),A(this,t,V,S,i,{name:0})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
