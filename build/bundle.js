var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(e,n,r){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function c(t){return null==t?"":t}function a(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode.removeChild(t)}function f(t){return document.createElement(t)}function h(t){return document.createTextNode(t)}function p(){return h(" ")}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function d(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}function m(t,e,n){t.classList[n?"add":"remove"](e)}let $;function v(t){$=t}const w=[],y=[],b=[],_=[],k=Promise.resolve();let x=!1;function E(t){b.push(t)}let A=!1;const j=new Set;function S(){if(!A){A=!0;do{for(let t=0;t<w.length;t+=1){const e=w[t];v(e),D(e.$$)}for(v(null),w.length=0;y.length;)y.pop()();for(let t=0;t<b.length;t+=1){const e=b[t];j.has(e)||(j.add(e),e())}b.length=0}while(w.length);for(;_.length;)_.pop()();x=!1,A=!1,j.clear()}}function D(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const q=new Set;function M(t,e){t&&t.i&&(q.delete(t),t.i(e))}function V(t,e,n,r){if(t&&t.o){if(q.has(t))return;q.add(t),undefined.c.push((()=>{q.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function L(t){t&&t.c()}function R(t,n,s,i){const{fragment:c,on_mount:a,on_destroy:u,after_update:l}=t.$$;c&&c.m(n,s),i||E((()=>{const n=a.map(e).filter(o);u?u.push(...n):r(n),t.$$.on_mount=[]})),l.forEach(E)}function O(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function z(t,e){-1===t.$$.dirty[0]&&(w.push(t),x||(x=!0,k.then(S)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function C(e,o,s,i,c,a,u,f=[-1]){const h=$;v(e);const p=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(h?h.$$.context:[])),callbacks:n(),dirty:f,skip_bound:!1,root:o.target||h.$$.root};u&&u(p.root);let g=!1;if(p.ctx=s?s(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&c(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),g&&z(e,t)),n})):[],p.update(),g=!0,r(p.before_update),p.fragment=!!i&&i(p.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);p.fragment&&p.fragment.l(t),t.forEach(l)}else p.fragment&&p.fragment.c();o.intro&&M(e.$$.fragment),R(e,o.target,o.anchor,o.customElement),S()}v(h)}class T{$destroy(){O(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const B=[];var N;!function(t){t.Dark="dark",t.Light="light",t.Default="default"}(N||(N={}));const I="color-theme",F=window.localStorage,H=(K=N,t=>Object.values(K).includes(t));var K;const P=(()=>{let e=N.Default;try{const t=F.getItem(I);H(t)&&(e=t)}catch(t){}const{subscribe:n,set:r}=function(e,n=t){let r;const o=new Set;function i(t){if(s(e,t)&&(e=t,r)){const t=!B.length;for(const t of o)t[1](),B.push(t,e);if(t){for(let t=0;t<B.length;t+=2)B[t][0](B[t+1]);B.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(s,c=t){const a=[s,c];return o.add(a),1===o.size&&(r=n(i)||t),s(e),()=>{o.delete(a),0===o.size&&(r(),r=null)}}}}(e,(t=>{const e=({storageArea:e,key:n,newValue:r})=>{e===F&&n===I&&H(r)&&t(r)};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}));return{subscribe:n,set:t=>{let e=N.Default;H(t)&&(e=t);try{F.setItem(I,e),r(e)}catch(t){}}}})();function W(e){let n;return{c(){n=f("div"),n.textContent="Keyboard",g(n,"class","keyboard")},m(t,e){u(t,n,e)},p:t,i:t,o:t,d(t){t&&l(n)}}}class G extends T{constructor(t){super(),C(this,t,null,W,s,{})}}function J(t,e,n){const r=t.slice();return r[4]=e[n],r}function Q(e){let n,r,o,s,i=e[4].label+"";return{c(){n=f("option"),r=h(i),o=p(),n.__value=s=e[4].id,n.value=n.__value,g(n,"class","theme-changer__option")},m(t,e){u(t,n,e),a(n,r),a(n,o)},p:t,d(t){t&&l(n)}}}function U(e){let n,r,o,s,i,h,m,$,v=e[2],w=[];for(let t=0;t<v.length;t+=1)w[t]=Q(J(e,v,t));return{c(){n=f("div"),r=f("i"),i=p(),h=f("select");for(let t=0;t<w.length;t+=1)w[t].c();g(r,"class",o=c(`fas theme-changer__icon fa-${e[1].icon}`)+" svelte-lru31z"),g(r,"title",s=e[1].label),g(h,"aria-label","Color theme select"),g(h,"class","theme-changer__select svelte-lru31z"),void 0===e[0]&&E((()=>e[3].call(h))),g(n,"class","theme-changer svelte-lru31z")},m(t,o){u(t,n,o),a(n,r),a(n,i),a(n,h);for(let t=0;t<w.length;t+=1)w[t].m(h,null);var s,c,l,f;d(h,e[0]),m||(s=h,c="change",l=e[3],s.addEventListener(c,l,f),$=()=>s.removeEventListener(c,l,f),m=!0)},p(t,[e]){if(2&e&&o!==(o=c(`fas theme-changer__icon fa-${t[1].icon}`)+" svelte-lru31z")&&g(r,"class",o),2&e&&s!==(s=t[1].label)&&g(r,"title",s),4&e){let n;for(v=t[2],n=0;n<v.length;n+=1){const r=J(t,v,n);w[n]?w[n].p(r,e):(w[n]=Q(r),w[n].c(),w[n].m(h,null))}for(;n<w.length;n+=1)w[n].d(1);w.length=v.length}5&e&&d(h,t[0])},i:t,o:t,d(t){t&&l(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(w,t),m=!1,$()}}}function X(t,e,n){let r,o;i(t,P,(t=>n(0,o=t)));const s=[{id:N.Light,label:"Light",icon:"sun"},{id:N.Dark,label:"Dark",icon:"moon"},{id:N.Default,label:"System",icon:"adjust"}];return t.$$.update=()=>{1&t.$$.dirty&&n(1,r=s.find((({id:t})=>t===o)))},[o,r,s,function(){o=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),P.set(o),n(2,s)}]}class Y extends T{constructor(t){super(),C(this,t,X,U,s,{})}}function Z(e){let n,r,o,s,i,c,h,d,m,$,v;return o=new Y({}),$=new G({}),{c(){n=f("main"),r=f("div"),L(o.$$.fragment),s=p(),i=f("div"),i.textContent="120",c=p(),h=f("div"),h.innerHTML='50\n    <span class="calculator__query__operator svelte-1jh8uf2">-</span>\n    10\n    <span class="calculator__query__operator svelte-1jh8uf2">-</span>\n    10\n    <span class="calculator__query__operator svelte-1jh8uf2">-</span>\n    10\n    <span class="calculator__query__operator svelte-1jh8uf2">+</span>\n    100',d=p(),m=f("div"),L($.$$.fragment),g(r,"class","calculator__settings"),g(i,"class","calculator__result svelte-1jh8uf2"),g(h,"class","calculator__query svelte-1jh8uf2"),g(m,"class","calculator__keyboard svelte-1jh8uf2"),g(n,"class","calculator svelte-1jh8uf2")},m(t,e){u(t,n,e),a(n,r),R(o,r,null),a(n,s),a(n,i),a(n,c),a(n,h),a(n,d),a(n,m),R($,m,null),v=!0},p:t,i(t){v||(M(o.$$.fragment,t),M($.$$.fragment,t),v=!0)},o(t){V(o.$$.fragment,t),V($.$$.fragment,t),v=!1},d(t){t&&l(n),O(o),O($)}}}class tt extends T{constructor(t){super(),C(this,t,null,Z,s,{})}}function et(t){let e,n,r;return n=new tt({}),{c(){e=f("div"),L(n.$$.fragment),g(e,"class","container svelte-8c6ys1"),m(e,"dark","dark"===t[0]),m(e,"light","light"===t[0])},m(t,o){u(t,e,o),R(n,e,null),r=!0},p(t,[n]){1&n&&m(e,"dark","dark"===t[0]),1&n&&m(e,"light","light"===t[0])},i(t){r||(M(n.$$.fragment,t),r=!0)},o(t){V(n.$$.fragment,t),r=!1},d(t){t&&l(e),O(n)}}}function nt(t,e,n){let r;return i(t,P,(t=>n(0,r=t))),[r]}class rt{constructor({token:t,priority:e=0,oneArgument:n=!1,view:r,calc:o}={}){if(this.token=t,this.priority=e,this.oneArgument=n,this.calc=o,r)this.view=r;else{const e=Array.isArray(t);if(e&&!t.length)throw new Error("View is required for twoArgument operators without token");const r=e?t[0]:t;this.view=n?t=>`${t}${r}`:(t,e)=>`${t} ${r} ${e}`}}}var ot=new rt({token:"empty",oneArgument:!0,view:t=>t,calc:t=>t}),st=new rt({token:"+",calc:(t,e)=>t+e}),it=new rt({token:"-",calc:(t,e)=>t-e}),ct=new rt({token:"*",priority:5,calc:(t,e)=>t*e}),at=new rt({token:"/",priority:5,calc:(t,e)=>t/e}),ut=new rt({token:"^",priority:5,calc:(t,e)=>t**e,view:(t,e)=>`${t}^${e}`}),lt=new rt({token:"sqr",priority:5,oneArgument:!0,calc:t=>t*t});const ft=t=>{if(t<0)throw new Error("Negative value hasn't factorial");if(t%1)throw new Error("Fraction value hasn't factorial");return t>=0&&t<=2?t:t*ft(t-1)};var ht=new rt({token:"!",priority:10,oneArgument:!0,calc:ft,view:t=>`${t}!`});const pt=[st,it,ct,at,ut,lt,ht];class gt{constructor(t,e,n){if(this.operator=t,this.v1=e,this.v2=n,!t.oneArgument&&void 0===n)throw new Error(`Operator "${t.token}" require two arguments`)}getMaxDepth(){const t=this.v1 instanceof gt?this.v1.getMaxDepth()+1:1,e=this.v2 instanceof gt?this.v2.getMaxDepth()+1:1;return Math.max(t,e)}getV1View(t=1){if(0===t)return`${this.exec()}`;if(this.v1 instanceof gt){const e=this.v1.operator.priority<this.operator.priority,n=this.v1.view(t-1);return e&&t>1?`(${n})`:n}return`${this.v1}`}getV2View(t=1){if(0===t)return`${this.exec()}`;if(this.v2 instanceof gt){const e=this.v2.operator.priority<this.operator.priority,n=this.v2.view(t-1);return e&&t>1?`(${n})`:n}return`${this.v2}`}view(t=1){if(t<0){const e=this.getMaxDepth();t=Math.max(e+1+t,0)}if(0===t)return`${this.exec()}`;const e=this.getV1View(t);if(this.operator.oneArgument)return this.operator.view(e);const n=this.getV2View(t);return this.operator.view(e,n)}exec(){if(this.result)return this.result;const t=this.v1 instanceof gt?this.v1.exec():this.v1;if(this.operator.oneArgument)return this.result=this.operator.calc(t),this.result;const e=this.v2 instanceof gt?this.v2.exec():this.v2;return this.result=this.operator.calc(t,e),this.result}}const dt=(t="")=>t.replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&");class mt{constructor({operators:t=pt}={}){this.operators=t}getMatchRegex(){const t=[{matcher:this.operators.reduce(((t,{token:e})=>t.concat(e)),[]).map(dt).join("|"),name:"operator"},{matcher:mt.numberRegexpString,name:"number"},{matcher:mt.bracketsRegexpString,name:"bracket"}].map((({name:t,matcher:e})=>`(?<${t}>${e})`)).join("|");return new RegExp(t,"g")}static validateBrackets(t){const e=t.match(new RegExp(mt.bracketsRegexpString,"g"));if(!e)return!0;let n=0;return e.forEach((t=>{")"===t?n--:n++})),0===n}getOperatorByToken(t){return this.operators.find((e=>"string"==typeof e.token?e.token===t:e.token.includes(t)))}parseString(t){const e=((t,e)=>{const n=[];let r;for(;r=t.exec(e);)n.push(r);return n})(this.getMatchRegex(),t),n=[];let r=0;return e.forEach((({groups:t},o)=>{const{number:s,bracket:i,operator:c}=t,a=e[o-1],u=e[o+1];if(i)")"===i?r-=100:"("===i&&(a&&a.groups.number&&n.push({operator:ct,priority:r+ct.priority}),r+=100);else if(c)if("+"!==c&&"-"!==c||a&&!(a&&a.groups.operator&&u&&u.groups.number)){const t=this.getOperatorByToken(c);n.push({operator:t,priority:r+t.priority})}else u.groups.number=`${c}${u.groups.number}`;else if(s){const{groups:{bracket:t=null}={}}=a||{};")"===t&&n.push({operator:ct,priority:r+ct.priority}),n.push(parseFloat(s.replace(",",".")))}})),n}compile(t=""){if(!mt.validateBrackets(t))throw new Error("Invalid brackets");const e=this.parseString(t),n=e.filter((t=>"number"!=typeof t)),r=e.slice();if(n.sort(((t,e)=>e.priority-t.priority)).forEach((t=>{const{operator:e,priority:n}=t,o=r.indexOf(t),s=r[o-1];if(s&&"number"!=typeof s&&!(s instanceof gt)){const{operator:{token:t}}=s;throw new Error(`Two operators in a row 1:"${t}", 2:"${e.token}"`)}if(e.oneArgument)r.splice(o-1,2,new gt(e,s));else{const t=r[o+1];if(t&&"number"!=typeof t&&!(t instanceof gt)){const{operator:{token:n}}=t;throw new Error(`Two operators in a row 1:"${e.token}", 2:"${n}"`)}r.splice(o-1,3,new gt(e,s,t))}})),r.length>1)throw new Error('Wrong arguments location with "oneArgument" operators');if(!r.length)throw new Error("No operators");const o=r[0];return"number"==typeof o?new gt(ot,o):o}calc(t=""){return this.compile(t).exec()}}mt.numberRegexpString="(?:[-+])?\\d+(?:[,.]\\d+)?",mt.bracketsRegexpString="[()]";const $t=new class extends T{constructor(t){super(),C(this,t,nt,et,s,{})}}({target:document.body});return window.Calculator=mt,window.calc=new mt,$t}();
//# sourceMappingURL=bundle.js.map
